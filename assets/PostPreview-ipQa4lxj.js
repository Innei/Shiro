import{j as e,r as o}from"./index-BrLHw_rO.js";import{u as g}from"./useQuery-BbGCGyIB.js";import{r as j,p as f,q as T,t as d,N as x,v as z,P as C,w as A,A as R,x as S}from"./ShareModal-C5VdFJDI.js";import{u as y,a as E}from"./provider-CPAML1Dv.js";import{M as B}from"./StyledButton-CcLO_ywH.js";import{F}from"./FloatPopover-BsJhjSNd.js";import{b as D,u as V}from"./index-hPcEA_SR.js";import{c as v,a as u}from"./helper-jIGjUHP-.js";import{L as w}from"./index-Ba4KaKv3.js";import{a as $}from"./use-event-callback-DU0VCmJv.js";import{a as N,u as q,x as b,A as p}from"./owner-CdJStYC4.js";import{M as H,W as O}from"./Gallery-CJAlU4I7.js";import{A as k,m as M}from"./proxy-RnJDDj_j.js";import{T as W,n as h,b as Z,c as K,L as Q}from"./Markdown-B7F4KgtF.js";import{R as G}from"./LinkCard-CzLeCwjL.js";import"./SocialSourceLink-DAa8hOSp.js";import"./bangumi-DGWEI3g8.js";import"./lodash-Ch6W0gOk.js";import"./use-combine-values-BYGqeSLy.js";import"./index-DW-JcjwO.js";import"./use-motion-template-ChoBp52r.js";import"./use-ref-value-DeLNmgK0.js";import"./dom-BowoBODo.js";import"./Shiki-k9E3sR35.js";import"./spring-BSAt5qpK.js";import"./index-NWdC_amn.js";import"./index-Bv477fdY.js";import"./use-is-dark-CQSQL4aT.js";import"./customParseFormat-DLTVoePo.js";import"./use-animation-DiJwvt5e.js";import"./visual-element-D0q80t7I.js";import"./use-is-unmounted-CIFBFr9d.js";import"./use-drag-controls-BvgSnI2Q.js";import"./use-spring-BmvTwTfg.js";import"./index-D5dveEOu.js";import"./Collapse-VKiPgm-a.js";function J(t){return e.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",...t,children:e.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M10 15h4V9h-4v6Zm0 2v3a1 1 0 0 1-2 0v-3H5a1 1 0 0 1 0-2h3V9H5a1 1 0 1 1 0-2h3V4a1 1 0 1 1 2 0v3h4V4a1 1 0 0 1 2 0v3h3a1 1 0 0 1 0 2h-3v6h3a1 1 0 0 1 0 2h-3v3a1 1 0 0 1-2 0v-3h-4Z"})})}function U(){return e.jsx("i",{className:"i-mingcute-thumb-up-line"})}const X=()=>e.jsx("svg",{version:"1.1",x:"0px",y:"0px",width:"59.227px",height:"59.227px",viewBox:"0 0 59.227 59.227",className:"fill-current",children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{d:`M51.586,10.029c-0.333-0.475-0.897-0.689-1.449-0.607c-0.021-0.005-0.042-0.014-0.063-0.017L27.469,6.087
			c-0.247-0.037-0.499-0.01-0.734,0.076L8.63,12.799c-0.008,0.003-0.015,0.008-0.023,0.011c-0.019,0.008-0.037,0.02-0.057,0.027
			c-0.099,0.044-0.191,0.096-0.276,0.157c-0.026,0.019-0.051,0.038-0.077,0.059c-0.093,0.076-0.178,0.159-0.249,0.254
			c-0.004,0.006-0.01,0.009-0.014,0.015L0.289,23.78c-0.293,0.401-0.369,0.923-0.202,1.391c0.167,0.469,0.556,0.823,1.038,0.947
			l6.634,1.713v16.401c0,0.659,0.431,1.242,1.062,1.435l24.29,7.422c0.008,0.004,0.017,0.001,0.025,0.005
			c0.13,0.036,0.266,0.059,0.402,0.06c0.003,0,0.007,0.002,0.011,0.002l0,0h0.001c0.143,0,0.283-0.026,0.423-0.067
			c0.044-0.014,0.085-0.033,0.13-0.052c0.059-0.022,0.117-0.038,0.175-0.068l17.43-9.673c0.477-0.265,0.772-0.767,0.772-1.312
			V25.586l5.896-2.83c0.397-0.19,0.69-0.547,0.802-0.973c0.111-0.427,0.03-0.88-0.223-1.241L51.586,10.029z M27.41,9.111
			l17.644,2.59L33.35,17.143l-18.534-3.415L27.41,9.111z M9.801,15.854l21.237,3.914l-6.242,9.364l-20.78-5.365L9.801,15.854z
			 M10.759,43.122V28.605l14.318,3.697c0.125,0.031,0.25,0.048,0.375,0.048c0.493,0,0.965-0.244,1.248-0.668l5.349-8.023v25.968
			L10.759,43.122z M49.479,41.1l-14.431,8.007V25.414l2.635,5.599c0.171,0.361,0.479,0.641,0.854,0.773
			c0.163,0.06,0.333,0.087,0.502,0.087c0.223,0,0.444-0.05,0.649-0.146l9.789-4.698L49.479,41.1L49.479,41.1z M39.755,28.368
			l-4.207-8.938L49.85,12.78l5.634,8.037L39.755,28.368z`})})})}),P=o.forwardRef,Y=N(null),_=P((t,s)=>{const{children:n,show:r=!0,...i}=t,{className:a,...l}=i;return e.jsx(k,{mode:"wait",children:r&&e.jsx(M.button,{ref:s,"aria-label":"Floating action button",initial:{opacity:.3,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:.3,scale:.8},className:v("mt-2 flex items-center justify-center","size-12 text-lg md:size-10 md:text-base","outline-accent hover:opacity-100 focus:opacity-100 focus:outline-none","rounded-xl border border-zinc-400/20 backdrop-blur-lg dark:border-zinc-500/30 dark:text-zinc-200","bg-zinc-50/80 shadow-lg dark:bg-neutral-900/80","transition-all duration-500 ease-in-out",a),...l,children:n})})});P((t,s)=>{const{onClick:n,children:r,show:i=!0}=t,a=o.useId(),l=q(Y),m=$();return t.onlyShowInMobile&&!m||!l?null:e.jsx(D,{to:l,children:e.jsx(_,{ref:s,id:a,show:i,onClick:n,children:r})})});const ee=({children:t,className:s})=>e.jsx("ul",{className:u("shiro-timeline",s),children:t});o.memo(function(s){const{count:n,name:r}=s;return e.jsx(W,{count:n,text:r,onClick:s.onClick,passProps:s})});const se=t=>{const{name:s}=t,{data:n,isLoading:r}=g({queryKey:[s,"tag"],queryFn:async({queryKey:a})=>{const[l]=a;return(await b.category.getTagByName(l)).data},staleTime:1e3*60*60*24}),{dismissAll:i}=y();return r?e.jsx("div",{className:"center flex h-24 w-full",children:e.jsx("div",{className:"loading loading-dots loading-md"})}):n?e.jsx(ee,{children:n.sort((a,l)=>new Date(l.created).getTime()-new Date(a.created).getTime()).map(a=>e.jsx("li",{className:"flex items-center justify-between","data-id":a.id,children:e.jsxs("span",{className:"flex min-w-0 shrink items-center",children:[e.jsx("span",{className:"mr-2 inline-block tabular-nums",children:Intl.DateTimeFormat("en-us",{month:"2-digit",day:"2-digit",year:"2-digit"}).format(new Date(a.created))}),e.jsx(w,{onClick:()=>{i()},href:j(f.Post,{category:a.category.slug,slug:a.slug}),className:"min-w-0 truncate leading-6",children:e.jsx("span",{className:"min-w-0 truncate",children:a.title})})]})},a.id))}):e.jsx(X,{})},L=({className:t,meta:s,children:n})=>{const{present:r}=y(),i=E(),a=V();return e.jsxs("div",{className:v("flex min-w-0 shrink grow flex-wrap gap-2 text-sm",t),children:[e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[!!s.created&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx("span",{children:e.jsx(d,{date:s.created})})]}),s.modified?a?e.jsxs(F,{mobileAsSheet:!0,wrapperClassName:"text-xs",as:"span",type:"tooltip",triggerElement:"(已编辑)",children:["编辑于 ",e.jsx(d,{date:s.modified})]}):e.jsx("span",{className:"text-xs",children:"(已编辑)"}):null]}),!!s.category&&e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[e.jsx(J,{className:"translate-y-[0.5px]"}),e.jsxs("span",{className:"min-w-0 truncate",children:[e.jsx(B,{onClick:()=>!!s.category&&i.push(j(f.Category,{slug:s.category.slug})),className:"shiro-link--underline font-normal",children:e.jsx("span",{children:s.category?.name})}),s.tags?.length?e.jsxs(e.Fragment,{children:[" ","/"," ",s.tags.map((l,m)=>{const I=m===s.tags.length-1;return e.jsxs(o.Fragment,{children:[e.jsx("button",{className:"shiro-link--underline",onClick:()=>r({content:()=>e.jsx(se,{name:l}),title:`Tag: ${l}`}),children:l},l),!I&&e.jsx("span",{children:", "})]},l)})]}):""]})]}),!!s.count?.read&&e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[e.jsx("i",{className:"i-mingcute-eye-2-line"}),e.jsx("span",{className:"min-w-0 truncate",children:e.jsx(x,{children:s.count.read})})]}),!!s.count?.like&&e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[e.jsx(U,{}),e.jsx("span",{className:"min-w-0 truncate",children:e.jsx(x,{children:s.count.like})})]}),n]})},{ModelDataProvider:te,ModelDataAtomProvider:ne,useModelDataSelector:c}=z(),re=()=>{const t=c(s=>s?.text);return t?e.jsx(Z,{allowsScript:!0,value:t,className:"min-w-0 overflow-hidden"}):null},ae=t=>{const s=c(n=>n?.images||h);return e.jsx(H,{images:s||h,children:t.children})},ie=({className:t})=>{const s=c(n=>{if(n)return{created:n.created,category:n.category,tags:n.tags,count:n.count,modified:n.modified}});return s?e.jsx(L,{meta:s,className:t}):null},le=({pin:t,id:s})=>{const[n,r]=o.useState(t);return e.jsx(C,{onPinChange:async i=>{await b.post.proxy(s).patch({data:{pin:i}}),r(i)},pin:n})},oe=()=>{const[t,s]=o.useState(!1),n=o.useRef(null);return o.useEffect(()=>{const r=n.current;if(!r)return;const i=r.parentElement;if(i)return i.onfocus=()=>{s(!0)},i.onblur=()=>{s(!1)},()=>{i.onfocus=null,i.onblur=null}},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:n,className:"absolute inset-0 z-10",onMouseEnter:()=>{s(!0)},onMouseLeave:()=>{s(!1)}}),e.jsx(k,{children:t&&e.jsx(M.div,{layout:!0,initial:{opacity:.2,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},layoutId:"post-item-hover-overlay",className:u("absolute z-[-1] rounded-xl","bg-accent/10 dark:bg-neutral-800","inset-y-4 -left-4 -right-6")})})]})};o.memo(function({data:s}){const n=s.text.length>300?`${G(s.text.slice(0,300))}...`:s.text,r=s.images?.length>0&&s.images[0].src,a=`/posts/${s.category?.slug}/${s.slug}`;return e.jsxs(w,{href:a,className:"relative flex flex-col py-8 focus-visible:!shadow-none",children:[e.jsx(oe,{}),e.jsxs("h2",{className:"relative text-balance break-words text-2xl font-medium",children:[s.title,e.jsx(le,{pin:!!s.pin,id:s.id})]}),e.jsxs("div",{className:"relative mt-8 space-y-2",children:[!!s.summary&&e.jsxs("p",{className:"mb-4 break-all rounded-md px-4 py-2 text-sm leading-relaxed text-gray-900 ring-1 ring-accent/10 dark:text-zinc-50",children:["摘要： ",s.summary]}),e.jsxs("div",{className:"relative overflow-hidden text-justify",children:[r&&e.jsx("div",{className:u("float-right mb-2 ml-3 size-[5.5rem] overflow-hidden rounded-md","bg-cover bg-center bg-no-repeat"),style:{backgroundImage:`url(${r})`}}),e.jsx("p",{className:"break-all leading-loose text-gray-800/90 dark:text-gray-200/90",children:n})]})]}),e.jsxs("div",{className:"post-meta-bar mt-2 flex select-none flex-wrap items-center justify-end gap-4 text-base-content/60",children:[e.jsx(L,{meta:s}),e.jsxs("span",{className:"flex shrink-0 select-none items-center space-x-1 text-right text-accent hover:text-accent [&>svg]:hover:ml-2",children:[e.jsx("span",{children:"阅读全文"}),e.jsx("i",{className:"i-mingcute-arrow-right-line text-lg transition-[margin]"})]})]})]})});const ce=()=>{const t=c(s=>s?.modified);return t&&p().diff(p(t),"day")>60?e.jsx(K,{type:"warning",className:"my-10",children:e.jsxs("span",{className:"leading-[1.8]",children:["这篇文章上次修改于 ",e.jsx(d,{date:t}),"，可能部分内容已经不适用，如有疑问可询问作者。"]})}):null},Ke=t=>{const{category:s,slug:n}=t,{data:r,isLoading:i}=g({...A.post.bySlug(s,n)}),a=o.useMemo(()=>N(null),[]);return i?e.jsx(Q,{className:"w-full",useDefaultLoadingText:!0}):r?e.jsxs(ne,{overrideAtom:a,children:[e.jsx(te,{data:r}),!!r.id&&e.jsx(R,{id:r.id,type:"post"}),e.jsx(S,{children:e.jsxs("article",{className:"prose relative w-full min-w-0",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-balance text-center",children:r.title}),e.jsx(ie,{className:"mb-8 justify-center"}),e.jsx(ce,{})]}),e.jsx(O,{eoaDetect:!0,children:e.jsx(ae,{children:e.jsx(re,{})})})]})})]}):null};export{Ke as PostPreview};
