import{r as t,j as e}from"./index-BrLHw_rO.js";import{u as H,a as F}from"./use-event-callback-DU0VCmJv.js";import{a as J,b as Q,u as _,s as Y,j as h}from"./owner-CdJStYC4.js";import{m as ee}from"./spring-BSAt5qpK.js";import{s as se,P as te,R as E,a as D,C as L,T as z,D as ne,b as oe}from"./index-hPcEA_SR.js";import{u as ae,D as re}from"./use-is-unmounted-CIFBFr9d.js";import{s as b,n as le}from"./dom-BowoBODo.js";import{c as w}from"./helper-jIGjUHP-.js";import{u as ie}from"./use-animation-DiJwvt5e.js";import{u as ce}from"./use-drag-controls-BvgSnI2Q.js";import{m as U,A as de}from"./proxy-RnJDDj_j.js";const me={},ue=t.createContext(null),l=J([]),he=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.4em",height:"1.4em",viewBox:"0 0 32 32",className:s,children:e.jsx("path",{fill:"currentColor",d:"M24 9.4L22.6 8L16 14.6L9.4 8L8 9.4l6.6 6.6L8 22.6L9.4 24l6.6-6.6l6.6 6.6l1.4-1.4l-6.6-6.6L24 9.4z"})}),xe={scale:1,opacity:1},O={scale:.96,opacity:0},T={initial:O,animate:xe,exit:O,transition:ee},W=100,fe=t.memo(function({item:o,index:d,onClose:m,children:x,isTop:g}){const f=Q(l),i=H(()=>{f(r=>r.filter(p=>p.id!==o.id)),m?.(!1)}),u=_(t.useMemo(()=>Y(l,r=>r.every(p=>p.id!==o.id)),[o.id]));t.useEffect(()=>{u&&(document.body.style.pointerEvents="auto")},[u]);const n=t.useCallback(r=>{r||i()},[i]),{CustomModalComponent:a,modalClassName:B,content:K,title:C,clickOutsideToDismiss:P,modalContainerClassName:S,wrapper:v=t.Fragment,max:V}=o,j=t.useMemo(()=>({zIndex:W+d+1}),[d]),I=t.useCallback(r=>{b(r),i()},[i]),k=F(),X=ae(),c=ie(),N=ce();t.useEffect(()=>{k||le(()=>{c.start(T.animate)})},[c,k]);const Z=t.useCallback(()=>{c.start({scale:1.05,transition:{duration:.06}}).then(()=>{X.current||c.start({scale:1})})},[c]);t.useEffect(()=>{if(!g)return c.start({scale:.96,y:10}),()=>{try{c.stop(),c.start({scale:1,y:0})}catch{}}},[g]);const q=t.useRef(null),y=t.useMemo(()=>({dismiss:()=>{A.current?.dismiss(),i()}}),[i]),G=t.useMemo(()=>({...y,ref:q}),[y]),M=e.jsx(ue.Provider,{value:G,children:x??t.createElement(K,y)}),R=t.useRef(null),A=t.useRef(null);if(k){const r=h.get(se).length;return e.jsx(v,{children:e.jsx(te,{ref:A,title:C,defaultOpen:!0,zIndex:1e3+r,onOpenChange:p=>{p||setTimeout(()=>{i()},1e3)},content:M})})}return a?e.jsx(v,{children:e.jsx(E,{open:!0,onOpenChange:n,children:e.jsx(D,{children:e.jsx(L,{asChild:!0,children:e.jsxs("div",{className:w("fixed inset-0 z-20 overflow-auto",u?"!pointer-events-none":"pointer-events-auto",S),onClick:P?I:void 0,style:j,children:[e.jsx(z,{className:"sr-only",children:C}),e.jsx("div",{className:"contents",onClick:b,children:e.jsx(a,{children:M})})]})})})})}):e.jsx(v,{children:e.jsx(E,{open:!0,onOpenChange:n,children:e.jsx(D,{children:e.jsx(L,{asChild:!0,children:e.jsx("div",{ref:R,className:w("center fixed inset-0 z-20 flex",u?"!pointer-events-none":"pointer-events-auto",S),style:j,onClick:P?I:Z,children:e.jsxs(U.div,{style:j,...T,animate:c,className:w("relative flex flex-col overflow-hidden rounded-lg","bg-zinc-50/90 dark:bg-neutral-900/90","p-2 shadow-2xl shadow-stone-300 backdrop-blur-sm dark:shadow-stone-800",V?"h-[90vh] w-[90vw]":"max-h-[70vh] min-w-[300px] max-w-[90vw] lg:max-h-[calc(100vh-20rem)] lg:max-w-[70vw]","border border-slate-200 dark:border-neutral-800",B),onClick:b,drag:!0,dragControls:N,dragListener:!1,dragElastic:0,dragMomentum:!1,dragConstraints:R,whileDrag:{cursor:"grabbing"},children:[e.jsxs("div",{className:"relative flex items-center",onPointerDown:r=>N.start(r),children:[e.jsx(z,{className:"shrink-0 grow items-center px-4 py-1 text-lg font-medium",children:C}),e.jsx(ne,{className:"p-2",onClick:i,children:e.jsx(he,{})})]}),e.jsx(re,{className:"my-2 shrink-0 border-slate-200 opacity-80 dark:border-neutral-800"}),e.jsx("div",{className:"min-h-0 shrink grow overflow-auto px-4 py-2",children:M})]})})})})})})}),Ae=()=>({push(s){location.pathname=s}}),pe=()=>location.pathname,ge=({zIndex:s})=>e.jsx(oe,{children:e.jsx(U.div,{id:"modal-overlay",className:"pointer-events-none fixed inset-0 z-[11] bg-zinc-50/80 dark:bg-neutral-900/80",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{zIndex:s}})}),Ce=()=>{const s=pe();t.useEffect(()=>{$.dismissAll()},[s])},Ee=s=>{const o=t.useId(),d=t.useRef(0),{wrapper:m}={};return{present:t.useCallback(x=>{const g=`${o}-${++d.current}`,f=x.id??g,u=h.get(l).find(n=>n.id===f);return u?h.set(l,n=>{const a=n.indexOf(u);return[...n.slice(0,a),...n.slice(a+1),u]}):h.set(l,n=>{const a={...x,id:f,wrapper:m};return me[a.id]=a,n.concat(a)}),()=>{h.set(l,n=>n.filter(a=>a.id!==f))}},[o]),...$}},$={dismiss(s){h.set(l,o=>o.filter(d=>d.id!==s))},dismissTop(){h.set(l,s=>s.slice(0,-1))},dismissAll(){h.set(l,[])}},De=({children:s})=>e.jsxs(e.Fragment,{children:[s,e.jsx(ve,{})]}),ve=()=>{const s=_(l);Ce();const o=s.some(m=>m.overlay),d=F();return e.jsxs(de,{mode:"popLayout",children:[s.map((m,x)=>e.jsx(fe,{item:m,index:x,isTop:x===s.length-1},m.id)),s.length>0&&o&&!d&&e.jsx(ge,{zIndex:W+s.length-1})]})};export{De as M,Ae as a,Ee as u};
